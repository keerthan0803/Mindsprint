<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Mandi Crop Prices</title>

  <style>
    :root{
      --bg: #f3fbf6;
      --card: #ffffff;
      --muted:#556b55;
      --accent:#2e8b57;
      --accent2: #b6e2c6;
      --glass: rgba(255,255,255,0.7);
      --radius:18px;
      --shadow: 0 8px 32px rgba(30,50,30,0.10);
      --shadow-hover: 0 16px 40px rgba(46,139,87,0.18);
      --gradient: linear-gradient(120deg, #e0ffe6 0%, #b6e2c6 100%);
      --gradient2: linear-gradient(90deg, #e0ffe6 0%, #f3fbf6 100%);
      --table-head: #2e8b57;
      --table-head-text: white;
      color-scheme: light;
    }

    [data-theme="dark"]{
      --bg: #000;
      --card: #111;
      --muted: #b6e2c6;
      --accent: #8fe0a2;
      --accent2: #222;
      --glass: rgba(20,20,20,0.7);
      --shadow: 0 8px 32px rgba(0,0,0,0.32);
      --shadow-hover: 0 16px 40px rgba(143,224,162,0.22);
      --gradient: linear-gradient(120deg, #232323 0%, #000 100%);
      --gradient2: linear-gradient(90deg, #232323 0%, #000 100%);
      --table-head: #8fe0a2;
      --table-head-text: #000;
    }

    [data-theme="forest"]{
      --bg: #1a2e22;
      --card: #223c2b;
      --muted: #d0f5e2;
      --accent: #7ed957;
      --accent2: #2e8b57;
      --glass: rgba(34,60,43,0.7);
      --shadow: 0 8px 32px rgba(46,139,87,0.22);
      --shadow-hover: 0 16px 40px rgba(126,217,87,0.22);
      --gradient: linear-gradient(120deg, #2e8b57 0%, #1a2e22 100%);
      --gradient2: linear-gradient(90deg, #2e8b57 0%, #1a2e22 100%);
      --table-head: #7ed957;
      --table-head-text: #000;
    }

    *{box-sizing:border-box}

    body{
      margin:0;
      font-family: 'Inter', system-ui;
      background: var(--gradient2);
      background-attachment: fixed;
      color:#113322;
      padding:28px;
      min-height:100vh;
      transition:background .35s ease, color .35s ease;
    }

    .container{max-width:1300px;margin:0 auto;}

    header{
      display:flex;align-items:center;justify-content:space-between;
      padding:16px 28px;
      background:var(--glass);
      border-radius:28px;
      box-shadow:var(--shadow);
      backdrop-filter: blur(10px);
      border: 1.5px solid #e0ffe6;
      margin-bottom: 20px;
      flex-wrap:wrap;
    }

    .logo img{
      width:48px;height:48px;border-radius:12px;
      box-shadow:0 6px 18px rgba(46,139,87,0.22);
    }

    h2 { text-align:center; margin-top:10px; }

    table {
      width:100%;
      border-collapse:collapse;
      margin-top:20px;
      background:var(--card);
      border-radius:12px;
      overflow:hidden;
      box-shadow:var(--shadow);
    }

    th{
      background:var(--table-head);
      color:var(--table-head-text);
      padding:10px;
      font-weight:600;
    }

    td{
      padding:8px;
      text-align:center;
      border-bottom:1px solid #ccc;
    }

    tr:hover{
      background:var(--accent2);
      transition:0.2s;
    }

    #loading{
      text-align:center;
      font-size:18px;
      margin-top:10px;
    }

    .search-box, .state-box{
      display:flex;
      gap:12px;
      margin:20px 0;
      justify-content:center;
      flex-wrap:wrap;
    }

    input, select{
      padding:10px 14px;
      border-radius:10px;
      border:1px solid #aaa;
      font-size:15px;
    }
  </style>

</head>
<body data-theme="light">

<div class="container">

  <!-- HEADER -->
  <header style="background: #fcfefd; box-shadow: 0 8px 32px rgba(30,50,30,0.10); border-radius:40px; padding:24px 48px; display:flex; align-items:center; justify-content:space-between; margin-bottom:32px; border: none; min-height:100px;">
    <div style="display:flex; align-items:center; gap:22px; min-width:0;">
      <div style="width:72px; height:72px; border-radius:20px; background:linear-gradient(135deg,#e0ffe6,#b6e2c6 80%); display:flex; align-items:center; justify-content:center; box-shadow:0 4px 18px rgba(46,139,87,0.10); border:2.5px solid #b6e2c6;">
        <img src="/static/logo.png" alt="My Smart Farm Logo" style="width:60px; height:60px; border-radius:14px; object-fit:contain; display:block;" />
      </div>
      <div>
        <div style="font-size:2.1rem; font-weight:900; color:#184c2b; font-family:'Inter',sans-serif; letter-spacing:0.01em;">My Smart Farm</div>
        <div style="font-size:1.1rem; color:#3a5c47; margin-top:2px; font-weight:400; letter-spacing:0.01em;">smart farming ‚Äî soil to harvest</div>
      </div>
    </div>
    <button id="themeBtn" style="font-size:2rem; background:transparent; border:none; cursor:pointer; margin-right:8px; margin-top:2px;">üåô</button>
  </header>


  <h2 style="text-align:center; margin-top:10px; font-size:2.1rem; font-weight:900; color:#184c2b; letter-spacing:0.01em;">Realtime Crop Prices</h2>

  <!-- SEARCH + FILTERS (side by side, with icon) -->
  <div style="display:flex; justify-content:center; align-items:center; gap:18px; margin:24px 0 18px 0; flex-wrap:wrap;">
    <form style="display:flex; align-items:center; background:var(--card); border-radius:24px; box-shadow:0 4px 18px rgba(46,139,87,0.10); border:1.5px solid #b6e2c6; padding:4px 8px 4px 18px; min-width:370px; max-width:480px; width:100%;">
      <input type="text" id="search" placeholder="Search crop, market, state, variety‚Ä¶" style="flex:1; border:none; background:transparent; font-size:1.15rem; padding:16px 0 16px 0; outline:none; color:#184c2b;">
      <button type="submit" style="background:transparent; border:none; border-radius:18px; padding:0 18px; height:44px; display:flex; align-items:center; justify-content:center; cursor:pointer; margin-left:8px; box-shadow:none; transition:background .2s;">
        <span style="font-size:1.5rem; color:#2e8b57;">üîç</span>
      </button>
    </form>
    <select id="stateFilter" style="padding:16px 18px; border-radius:16px; border:1.5px solid #b6e2c6; font-size:1.1rem; min-width:180px; background:var(--card); box-shadow:0 2px 12px rgba(46,139,87,0.07);">
      <option value="">All States</option>
    </select>
  </div>

  <div id="loading">Loading prices, please wait...</div>

  <!-- DATA TABLE -->
  <table style="width:100%; border-collapse:separate; border-spacing:0; margin-top:28px; background:var(--card); border-radius:22px; overflow:hidden; box-shadow:0 8px 32px rgba(30,50,30,0.10); border:2.5px solid #e0ffe6;">
    <thead>
      <tr>
        <th style="padding:18px 12px; font-size:1.08rem; background:var(--table-head); color:var(--table-head-text); border-bottom:2.5px solid #b6e2c6;">Commodity</th>
        <th style="padding:18px 12px; font-size:1.08rem; background:var(--table-head); color:var(--table-head-text); border-bottom:2.5px solid #b6e2c6;">Variety</th>
        <th style="padding:18px 12px; font-size:1.08rem; background:var(--table-head); color:var(--table-head-text); border-bottom:2.5px solid #b6e2c6;">Market</th>
        <th style="padding:18px 12px; font-size:1.08rem; background:var(--table-head); color:var(--table-head-text); border-bottom:2.5px solid #b6e2c6;">District</th>
        <th style="padding:18px 12px; font-size:1.08rem; background:var(--table-head); color:var(--table-head-text); border-bottom:2.5px solid #b6e2c6;">State</th>
        <th style="padding:18px 12px; font-size:1.08rem; background:var(--table-head); color:var(--table-head-text); border-bottom:2.5px solid #b6e2c6;">Min</th>
        <th style="padding:18px 12px; font-size:1.08rem; background:var(--table-head); color:var(--table-head-text); border-bottom:2.5px solid #b6e2c6;">Max</th>
        <th style="padding:18px 12px; font-size:1.08rem; background:var(--table-head); color:var(--table-head-text); border-bottom:2.5px solid #b6e2c6;">Modal</th>
        <th style="padding:18px 12px; font-size:1.08rem; background:var(--table-head); color:var(--table-head-text); border-bottom:2.5px solid #b6e2c6;">Date</th>
      </tr>
    </thead>
    <tbody id="priceData"></tbody>
  </table>

</div>

<script>
/* ------- THEME SWITCH ----------- */
const themeBtn = document.getElementById("themeBtn");
const body = document.body;

const themes = [
  {name:"light", icon:"üåô"},
  {name:"dark", icon:"üå≤"},
  {name:"forest", icon:"‚òÄÔ∏è"}
];

let saved = localStorage.getItem("msf-theme") || "light";
let idx = themes.findIndex(t => t.name === saved);
if(idx < 0) idx = 0;

function applyTheme(i){
  body.setAttribute("data-theme", themes[i].name);
  themeBtn.textContent = themes[i].icon;
  localStorage.setItem("msf-theme", themes[i].name);
}
applyTheme(idx);

themeBtn.onclick = ()=>{
  idx = (idx+1)%themes.length;
  applyTheme(idx);
};


/* ---------- DATA FETCHING & FILTERING ----------- */
let allRecords = [];

async function loadPrices(){
  const url =
   "https://api.data.gov.in/resource/9ef84268-d588-465a-a308-a864a43d0070?api-key=579b464db66ec23bdd00000159ddd2c3a988470b5aa5c69f8e448614&format=json&limit=1000";

  try{
    const res = await fetch(url);
    const data = await res.json();
    allRecords = data.records;

    generateStateDropdown();
    renderTable(allRecords);

    document.getElementById("loading").style.display = "none";

  }catch(e){
    document.getElementById("loading").innerHTML="Error loading data!";
    console.error(e);
  }
}

/* ---------- GENERATE SORTED STATES LIST ---------- */
function generateStateDropdown(){
  const stateSet = new Set(allRecords.map(r => r.state));
  const sorted = [...stateSet].sort();

  const dropdown = document.getElementById("stateFilter");

  sorted.forEach(state=>{
    dropdown.innerHTML += `<option value="${state}">${state}</option>`;
  });
}

/* ---------- RENDER TABLE ----------- */
function renderTable(records){
  let rows = "";

  records.forEach(item=>{
    rows += `
      <tr>
        <td>${item.commodity || "-"}</td>
        <td>${item.variety || "-"}</td>
        <td>${item.market || "-"}</td>
        <td>${item.district || "-"}</td>
        <td>${item.state || "-"}</td>
        <td>${item.min_price || "-"}</td>
        <td>${item.max_price || "-"}</td>
        <td>${item.modal_price || "-"}</td>
        <td>${item.arrival_date || "-"}</td>
      </tr>
    `;
  });

  document.getElementById("priceData").innerHTML = rows;
}

/* ---------- SEARCH + FILTER ---------- */
document.getElementById("search").addEventListener("input", filterData);
document.getElementById("stateFilter").addEventListener("change", filterData);

function filterData(){
  let search = document.getElementById("search").value.toLowerCase();
  let state = document.getElementById("stateFilter").value;

  let filtered = allRecords.filter(r=>{
    let matchesSearch =
      r.commodity.toLowerCase().includes(search) ||
      r.variety.toLowerCase().includes(search) ||
      r.market.toLowerCase().includes(search) ||
      r.state.toLowerCase().includes(search);

    let matchesState = state ? r.state === state : true;

    return matchesSearch && matchesState;
  });

  renderTable(filtered);
}

loadPrices();
</script>

</body>
</html>
